<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signup | PoornimaX</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        /* --- Multi-Step Form Theme by Gemini --- */
        :root {
            --primary: #3b82f6; --primary-light: #60a5fa;
            --bg: #f8f9fa; --bg-card: #ffffff;
            --text: #1f2937; --text-light: #6c757d;
            --border: #e9ecef; --shadow: rgba(0, 0, 0, 0.08);
            --radius: 12px; --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); display: grid; place-items: center; min-height: 100vh; padding: 20px 0; position: relative; overflow-x: hidden; }

        /* 1. Loader & Background */
        .loader-container { position: fixed; inset: 0; background-color: var(--bg); display: grid; place-items: center; z-index: 1000; transition: opacity 0.5s ease-out, visibility 0.5s ease-out; }
        .loader { display: flex; gap: 8px; }
        .loader div { width: 12px; height: 12px; border-radius: 50%; background-color: var(--primary); animation: pulse 1.4s ease-in-out infinite both; }
        .loader div:nth-child(1) { animation-delay: -0.32s; }
        .loader div:nth-child(2) { animation-delay: -0.16s; }
        @keyframes pulse { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; } 40% { transform: scale(1.0); opacity: 1; } }

        .background-blobs { position: fixed; inset: 0; z-index: -1; }
        .blob { position: absolute; border-radius: 50%; opacity: 0.6; filter: blur(90px); animation: drift 40s infinite linear alternate; }
        .blob.blue { background: #aed6f1; }
        .blob.purple { background: #d5bcf0; animation-duration: 50s; }
        .blob:nth-of-type(1) { width: 400px; height: 400px; top: -150px; left: -200px; }
        .blob:nth-of-type(2) { width: 300px; height: 300px; bottom: -150px; right: -150px; animation-direction: alternate-reverse; }
        @keyframes drift { from { transform: rotate(0deg) scale(1) translateX(-30px); } to { transform: rotate(360deg) scale(1.2) translateX(30px); } }

        /* 2. Main Container & Form Structure */
        .container { background: var(--bg-card); border-radius: var(--radius); box-shadow: 0 8px 32px var(--shadow); width: 95%; max-width: 600px; padding: 40px; text-align: center; border: 1px solid var(--border); }
        h1 { background: linear-gradient(45deg, var(--primary), var(--primary-light)); background-clip: text; -webkit-background-clip: text; color: transparent; font-size: 2.2rem; font-weight: 700; margin-bottom: 10px; }
        h2 { color: var(--text-light); font-size: 1.1rem; font-weight: 400; margin-bottom: 30px; }
        
        /* Progress Bar */
        .progress-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; position: relative; }
        .progress-bar .step { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .progress-bar .step .icon { width: 35px; height: 35px; border-radius: 50%; background: var(--bg); border: 2px solid var(--border); display: grid; place-items: center; font-weight: 600; color: var(--text-light); transition: var(--transition); z-index: 2; }
        .progress-bar .step .text { font-size: 0.8rem; font-weight: 500; color: var(--text-light); margin-top: 8px; }
        .progress-bar .step.active .icon { border-color: var(--primary); background: var(--primary); color: white; }
        .progress-bar::before { content: ''; position: absolute; top: 17px; left: 0; width: 100%; height: 2px; background: var(--border); z-index: 1; }
        #progress { position: absolute; top: 17px; left: 0; width: 0%; height: 2px; background: var(--primary); z-index: 1; transition: width 0.4s ease; }

        /* Form Steps Wrapper */
        .form-outer { overflow: hidden; }
        #multiStepForm { display: flex; width: 300%; /* 3 steps * 100% */ }
        .form-step { width: calc(100% / 3); transition: var(--transition); padding: 0 5px; /* Padding to prevent content touching edges */ }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; text-align: left; }
        .form-grid.full-width { grid-template-columns: 1fr; }
        
        /* Inputs, Selects, Textareas */
        input, select, textarea { background: var(--bg); color: var(--text); border: 1px solid var(--border); padding: 12px; border-radius: 8px; font-size: 0.95rem; width: 100%; outline: none; transition: var(--transition); }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        textarea { resize: vertical; min-height: 80px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; }

        /* 3. New Profile Picture Placeholder */
        .pfp-upload-group { display: flex; flex-direction: column; align-items: center; gap: 10px; margin-bottom: 20px; }
        .pfp-placeholder { width: 120px; height: 120px; border-radius: 50%; border: 2px dashed var(--border); background-color: var(--bg); display: grid; place-items: center; cursor: pointer; transition: var(--transition); background-size: cover; background-position: center; }
        .pfp-placeholder:hover { border-color: var(--primary); background-color: #e9ecef; }
        .pfp-placeholder .icon { color: var(--text-light); width: 40px; height: 40px; transition: var(--transition); }
        .pfp-placeholder:hover .icon { color: var(--primary); }
        /* Hide the default file input */
        #profile_picture { display: none; }

        /* Navigation Buttons */
        .btn-group { display: flex; justify-content: space-between; margin-top: 30px; }
        .btn { background: var(--primary); color: #ffffff; padding: 12px 24px; border-radius: 8px; border: 2px solid var(--primary); font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--transition); display: flex; justify-content: center; align-items: center; gap: 8px; position: relative; }
        .btn-prev { background: transparent; color: var(--text); border-color: var(--border); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15); }
        .btn-prev:hover { background-color: var(--bg); border-color: var(--text-light); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .btn-spinner { width: 22px; height: 22px; border: 3px solid rgba(255, 255, 255, 0.4); border-top-color: #ffffff; border-radius: 50%; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        button.btn--loading { cursor: wait; pointer-events: none; color: transparent !important; }
        button.btn--loading .btn-spinner { display: block; position: absolute; }
        
        .link-text { margin-top: 25px; } .link-text a { color: var(--primary); text-decoration: none; font-weight: 500; }
        .error-message { color: #dc3545; font-size: 0.9rem; margin-top: 15px; }
        .footer { position: fixed; bottom: 0; width: 200%; background-color: rgba(255, 255, 255, 0.7); backdrop-filter: blur(5px); border-top: 1px solid var(--border); color: var(--text-light); text-align: center; padding: 15px 0; font-size: 0.9rem; font-weight: 600; letter-spacing: 3px; z-index: 5; }
    </style>
</head>
<body>
    <div class="loader-container" id="loaderContainer">
        <div class="loader"><div></div><div></div><div></div></div>
    </div>
    <div class="background-blobs">
        <div class="blob blue"></div>
        <div class="blob purple"></div>
    </div>

    <main class="container">
        <h1>Create Your Account</h1>
        <h2>Join a vibrant community of learners and creators.</h2>

        <div class="progress-bar">
            <div id="progress"></div>
            <div class="step active" data-step="1"><div class="icon">1</div><div class="text">Account</div></div>
            <div class="step" data-step="2"><div class="icon">2</div><div class="text">Profile</div></div>
            <div class="step" data-step="3"><div class="icon">3</div><div class="text">Academic</div></div>
        </div>

        <div class="form-outer">
            <form method="POST" enctype="multipart/form-data" action="{% url 'accounts:signup_access' %}" id="multiStepForm">
                {% csrf_token %}
                <div class="form-step">
                    <div class="form-grid">
                        <div class="input-group" style="grid-column: 1 / -1;"><label for="full_name">Full Name</label><input type="text" id="full_name" name="full_name" required></div>
                        <div class="input-group" style="grid-column: 1 / -1;"><label for="username">Username</label><input type="text" id="username" name="username" required></div>
                        <div class="input-group" style="grid-column: 1 / -1;"><label for="college_email">College Email</label><input type="email" id="college_email" name="college_email" required></div>
                        <div class="input-group"><label for="password">Password</label><input type="password" id="password" name="password" required></div>
                        <div class="input-group"><label for="confirm_password">Confirm Password</label><input type="password" id="confirm_password" name="confirm_password" required></div>
                    </div>
                </div>

                <div class="form-step">
                    <div class="form-grid full-width">
                        <div class="pfp-upload-group">
                             <label for="profile_picture" class="pfp-placeholder" id="pfpPlaceholder">
                                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4.883 19.017.5 19.017V4.983C.5 2.496 2.496.5 4.983.5h14.034c2.487 0 4.483 1.996 4.483 4.483v14.034h-4.383L19.5 19.017h-15l-.383-.017.383.017zm.617-1.5h13v-1.584l-2.05-2.05a1.5 1.5 0 0 0-2.122 0l-1.928 1.929-2.208-2.207a1.5 1.5 0 0 0-2.121 0L5.5 16.034V17.517zM9 10.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>
                             </label>
                             <input type="file" id="profile_picture" name="profile_picture" accept="image/*" required>
                             <label for="profile_picture" style="font-weight: 500; cursor: pointer;">Upload a Photo</label>
                        </div>
                        <div class="input-group"><label for="bio">Bio</label><textarea id="bio" name="bio" placeholder="Tell us about yourself..." required></textarea></div>
                        <div class="form-grid">
                           <div class="input-group"><label for="dob">Date of Birth</label><input type="date" id="dob" name="dob" required></div>
                           <div class="input-group"><label for="gender">Gender</label><select id="gender" name="gender" required><option value="" disabled selected>Select...</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
                        </div>
                    </div>
                </div>

                <div class="form-step">
                    <div class="form-grid full-width">
                        <div class="input-group"><label for="department">Department</label><select id="department" name="department" required><option value="" disabled selected>Select...</option><option value="CORE">CORE</option><option value="ECE">ECE</option><option value="Cyber Security">Cyber Security</option><option value="IT">IT</option><option value="Civil">Civil</option><option value="Mechanical">Mechanical</option><option value="Electrical">Electrical</option><option value="AI">AI</option><option value="AI DS">AI DS</option></select></div>
                        <div class="input-group"><label for="college">College</label><select id="college" name="college" required><option value="" disabled selected>Select...</option><option value="PCE">PCE</option><option value="PIET">PIET</option><option value="PU">PU</option></select></div>
                    </div>
                </div>
            </form>
        </div>

        <div class="btn-group">
            <button class="btn btn-prev" id="prevBtn" disabled>Previous</button>
            <button class="btn" id="nextBtn">Next</button>
        </div>

        {% if messages %}
            <div class="error-message">{% for message in messages %}<p>{{ message }}</p>{% endfor %}</div>
        {% endif %}
        <p class="link-text">Already have an account? <a href="{% url 'accounts:load_login' %}">Login</a></p>
    </main>

    <footer class="footer">Poornima college student</footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // --- Initial Page Loader ---
            const loaderContainer = document.getElementById("loaderContainer");
            if (loaderContainer.style.display !== 'none') {
                setTimeout(() => {
                    loaderContainer.style.opacity = '0';
                    loaderContainer.addEventListener('transitionend', () => loaderContainer.style.display = 'none', { once: true });
                }, 1000);
            }

            // --- New Profile Picture Preview Logic ---
            const pfpInput = document.getElementById('profile_picture');
            const pfpPlaceholder = document.getElementById('pfpPlaceholder');
            const pfpIcon = pfpPlaceholder.querySelector('.icon');

            pfpInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        pfpPlaceholder.style.backgroundImage = `url('${e.target.result}')`;
                        pfpPlaceholder.style.borderStyle = 'solid';
                        pfpIcon.style.display = 'none'; // Hide the icon
                    }
                    reader.readAsDataURL(file);
                }
            });

            // --- Multi-Step Form Logic ---
            const multiStepForm = document.getElementById('multiStepForm');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progress = document.getElementById('progress');
            const steps = document.querySelectorAll('.progress-bar .step');
            
            let currentStep = 1;
            const totalSteps = 3;

            nextBtn.addEventListener('click', () => {
                if (validateStep(currentStep)) {
                    if (currentStep < totalSteps) {
                        currentStep++;
                        updateForm();
                    }
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStep > 1) {
                    currentStep--;
                    updateForm();
                }
});
            
            multiStepForm.addEventListener('submit', (e) => {
                const submitButton = document.getElementById('nextBtn');
                submitButton.classList.add('btn--loading');
                const spinner = document.createElement('div');
                spinner.className = 'btn-spinner';
                submitButton.innerHTML = '';
                submitButton.appendChild(spinner);
            });

            function updateForm() {
                // Animate form slide
                multiStepForm.style.transform = `translateX(-${(currentStep - 1) * (100 / totalSteps)}%)`;

                // Update progress bar
                const progressWidth = ((currentStep - 1) / (totalSteps - 1)) * 100;
                progress.style.width = `${progressWidth}%`;

                // Update step icons
                steps.forEach((step, index) => {
                    step.classList.toggle('active', index < currentStep);
                });

                // Update button states
                prevBtn.disabled = currentStep === 1;
                if (currentStep === totalSteps) {
                    nextBtn.textContent = 'Sign Up';
                    nextBtn.type = 'submit';
                    nextBtn.setAttribute('form', 'multiStepForm');
                } else {
                    nextBtn.textContent = 'Next';
                    nextBtn.type = 'button';
                    nextBtn.removeAttribute('form');
                }
            }

            function validateStep(step) {
                const currentFormStep = multiStepForm.children[step - 1];
                const inputs = currentFormStep.querySelectorAll('input[required], select[required], textarea[required]');
                let isValid = true;
                
                inputs.forEach(input => {
                    const value = input.type === 'file' ? input.files.length : input.value.trim();
                    if (!value) {
                        // For file input, target the placeholder
                        if (input.type === 'file') {
                            const placeholder = document.getElementById('pfpPlaceholder');
                            placeholder.style.borderColor = '#dc3545';
                        } else {
                            input.style.borderColor = '#dc3545';
                        }
                        isValid = false;
                    } else {
                         if (input.type === 'file') {
                            document.getElementById('pfpPlaceholder').style.borderColor = 'var(--primary)';
                         } else {
                            input.style.borderColor = 'var(--border)';
                         }
                    }
                });

                // Password confirmation validation
                if (step === 1) {
                    const password = document.getElementById('password');
                    const confirmPassword = document.getElementById('confirm_password');
                    if (password.value !== confirmPassword.value) {
                        confirmPassword.style.borderColor = '#dc3545';
                        password.style.borderColor = '#dc3545';
                        if (!document.querySelector('.error-message.password-error')) {
                           const errorDiv = document.createElement('div');
                           errorDiv.className = 'error-message password-error';
                           errorDiv.textContent = 'Passwords do not match.';
                           multiStepForm.parentElement.insertBefore(errorDiv, document.querySelector('.btn-group'));
                        }
                        isValid = false;
                    } else {
                         const errorDiv = document.querySelector('.error-message.password-error');
                         if(errorDiv) errorDiv.remove();
                    }
                }
                
                return isValid;
            }
        });
    </script>
</body>
</html>
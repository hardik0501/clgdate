<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>About You | PoornimaX</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --primary: #3b82f6; --primary-light: #60a5fa;
            --bg: #f8f9fa; --bg-card: #ffffff;
            --text: #1f2937; --text-light: #6c757d;
            --border: #e9ecef; --shadow: rgba(0, 0, 0, 0.08);
            --radius: 12px; --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { 
            background-color: var(--bg); 
            color: var(--text); 
            min-height: 100vh; 
            padding: 20px; 
            position: relative; 
            overflow-x: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader-container { position: fixed; inset: 0; background-color: var(--bg); display: grid; place-items: center; z-index: 1000; transition: opacity 0.5s ease-out, visibility 0.5s ease-out; }
        .loader { display: flex; gap: 8px; }
        .loader div { width: 12px; height: 12px; border-radius: 50%; background-color: var(--primary); animation: pulse 1.4s ease-in-out infinite both; }
        .loader div:nth-child(1) { animation-delay: -0.32s; }
        .loader div:nth-child(2) { animation-delay: -0.16s; }
        @keyframes pulse { 0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; } 40% { transform: scale(1.0); opacity: 1; } }

        .background-blobs { position: fixed; inset: 0; z-index: -1; }
        .blob { position: absolute; border-radius: 50%; opacity: 0.6; filter: blur(90px); animation: drift 40s infinite linear alternate; }
        .blob.blue { background: #aed6f1; }
        .blob.purple { background: #d5bcf0; animation-duration: 50s; }
        .blob:nth-of-type(1) { width: 400px; height: 400px; top: -150px; left: -200px; }
        .blob:nth-of-type(2) { width: 300px; height: 300px; bottom: -150px; right: -150px; animation-direction: alternate-reverse; }
        @keyframes drift { from { transform: rotate(0deg) scale(1) translateX(-30px); } to { transform: rotate(360deg) scale(1.2) translateX(30px); } }

        .container { 
            background: var(--bg-card); 
            border-radius: var(--radius); 
            box-shadow: 0 8px 32px var(--shadow); 
            width: 100%; 
            max-width: 800px; 
            padding: 30px; 
            text-align: center; 
            border: 1px solid var(--border);
            margin: auto;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        h1 { color: var(--text); font-size: 1.8rem; font-weight: 700; margin-bottom: 8px; }
        h2 { color: var(--text-light); font-size: 1rem; font-weight: 400; margin-bottom: 30px; }
        
        .progress-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px; 
            position: relative; 
        }
        .progress-bar .step { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .progress-bar .step .icon { 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            background: var(--bg); 
            border: 2px solid var(--border); 
            display: grid; 
            place-items: center; 
            font-weight: 600; 
            color: var(--text-light); 
            transition: var(--transition); 
            z-index: 2; 
            font-size: 0.9rem;
        }
        .progress-bar .step .text { font-size: 0.75rem; font-weight: 500; color: var(--text-light); margin-top: 6px; }
        .progress-bar .step.active .icon { border-color: var(--primary); background: var(--primary); color: white; }
        .progress-bar::before { content: ''; position: absolute; top: 15px; left: 0; width: 100%; height: 2px; background: var(--border); z-index: 1; }
        #progress { position: absolute; top: 15px; left: 0; width: 0%; height: 2px; background: var(--primary); z-index: 1; transition: width 0.4s ease; }

        .form-outer { 
            overflow: hidden; 
            margin-bottom: 30px;
        }
        #multiStepForm { 
            display: flex; 
            width: 300%; 
            transition: var(--transition);
        }
        .form-step { 
            width: calc(100% / 3); 
            padding: 0 10px; 
            text-align: left; 
        }
        .question:not(:last-child) { margin-bottom: 30px; }
        .question-title { 
            font-weight: 600; 
            font-size: 1.1rem; 
            margin-bottom: 20px; 
            text-align: center; 
            color: var(--text);
        }

        .card-options { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); 
            gap: 12px; 
            max-width: 100%;
        }
        
        .card-options.large-grid {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        
        .card-label { 
            padding: 14px 12px; 
            border: 2px solid var(--border); 
            border-radius: var(--radius); 
            cursor: pointer; 
            transition: var(--transition); 
            text-align: center; 
            font-weight: 500; 
            font-size: 0.9rem;
            display: block;
            word-wrap: break-word;
            hyphens: auto;
        }
        .card-label:hover { 
            border-color: var(--primary-light); 
            background: #fafdff; 
            transform: translateY(-1px);
        }
        .card-input { display: none; }
        .card-input:checked + .card-label { 
            border-color: var(--primary); 
            background-color: #f0f6fe; 
            color: var(--primary); 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); 
        }
        
        .btn-group { 
            display: flex; 
            justify-content: space-between; 
            gap: 15px;
            margin-top: 20px;
        }
        .btn { 
            background: var(--primary); 
            color: #ffffff; 
            padding: 12px 24px; 
            border-radius: 8px; 
            border: 2px solid var(--primary); 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: var(--transition); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 8px; 
            position: relative; 
            flex: 1;
            min-height: 44px;
        }
        .btn-prev { 
            background: transparent; 
            color: var(--text); 
            border-color: var(--border); 
        }
        .btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15); 
        }
        .btn-prev:hover { 
            background-color: var(--bg); 
            border-color: var(--text-light); 
        }
        .btn:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }
        .btn-spinner { 
            width: 20px; 
            height: 20px; 
            border: 2px solid rgba(255, 255, 255, 0.4); 
            border-top-color: #ffffff; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            display: none; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        button.btn--loading { cursor: wait; pointer-events: none; color: transparent !important; }
        button.btn--loading .btn-spinner { display: block; position: absolute; }

        .footer { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background-color: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(5px); 
            border-top: 1px solid var(--border); 
            color: var(--text-light); 
            text-align: center; 
            padding: 12px 0; 
            font-size: 0.8rem; 
            font-weight: 600; 
            letter-spacing: 2px; 
            z-index: 5; 
        }
        
        @media (max-width: 768px) {
            .container { 
                padding: 25px 20px; 
                margin: 10px;
                max-height: 85vh;
            }
            h1 { font-size: 1.6rem; }
            h2 { font-size: 0.9rem; }
            .card-options { 
                grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); 
                gap: 10px;
            }
            .card-options.large-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            .card-label {
                padding: 12px 10px;
                font-size: 0.85rem;
            }
            .question-title {
                font-size: 1rem;
            }
            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px 15px;
                margin: 5px;
            }
            .card-options { 
                grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); 
            }
            .card-options.large-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            .progress-bar .step .text { font-size: 0.7rem; }
            .btn-group { 
                flex-direction: column; 
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loader-container" id="loaderContainer">
        <div class="loader"><div></div><div></div><div></div></div>
    </div>
    <div class="background-blobs">
        <div class="blob blue"></div><div class="blob purple"></div>
    </div>

    <main class="container">
        <h1>Tell Us About Yourself</h1>
        <h2>This helps us find the best connections for you.</h2>

        <div class="progress-bar">
            <div id="progress"></div>
            <div class="step active"><div class="icon">1</div><div class="text">About You</div></div>
            <div class="step"><div class="icon">2</div><div class="text">Your Vibe</div></div>
            <div class="step"><div class="icon">3</div><div class="text">Connections</div></div>
        </div>

        <div class="form-outer">
            <form method="POST" action="{% url 'accounts:questionnaire_view' %}" id="multiStepForm">
                {% csrf_token %}
                
                <div class="form-step">
                    <div class="question">
                        <h3 class="question-title">Your social energy is more...</h3>
                        <div class="card-options">
                            <div><input type="radio" name="personality" value="Introvert" id="p-1" class="card-input" required><label for="p-1" class="card-label">Introvert</label></div>
                            <div><input type="radio" name="personality" value="Extrovert" id="p-2" class="card-input" required><label for="p-2" class="card-label">Extrovert</label></div>
                            <div><input type="radio" name="personality" value="A mix of both" id="p-3" class="card-input" required><label for="p-3" class="card-label">A mix of both</label></div>
                        </div>
                    </div>
                    <div class="question">
                        <h3 class="question-title">You prefer to communicate via...</h3>
                        <div class="card-options">
                            <div><input type="radio" name="communication_style" value="Mostly texting" id="c-1" class="card-input" required><label for="c-1" class="card-label">Mostly texting</label></div>
                            <div><input type="radio" name="communication_style" value="Voice & video calls" id="c-2" class="card-input" required><label for="c-2" class="card-label">Voice & video calls</label></div>
                            <div><input type="radio" name="communication_style" value="A bit of everything" id="c-3" class="card-input" required><label for="c-3" class="card-label">A bit of everything</label></div>
                        </div>
                    </div>
                </div>

                <div class="form-step">
                    <div class="question">
                        <h3 class="question-title">What are some of your interests? (Select up to 5)</h3>
                        <div class="card-options large-grid">
                            <div><input type="checkbox" name="hobbies_interests" value="Gaming" id="h-1" class="card-input"><label for="h-1" class="card-label">Gaming</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Music" id="h-2" class="card-input"><label for="h-2" class="card-label">Music</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Movies & Shows" id="h-3" class="card-input"><label for="h-3" class="card-label">Movies & Shows</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Coding" id="h-4" class="card-input"><label for="h-4" class="card-label">Coding</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Sports" id="h-5" class="card-input"><label for="h-5" class="card-label">Sports</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Art & Design" id="h-6" class="card-input"><label for="h-6" class="card-label">Art & Design</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Reading" id="h-7" class="card-input"><label for="h-7" class="card-label">Reading</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Travel" id="h-8" class="card-input"><label for="h-8" class="card-label">Travel</label></div>
                            <div><input type="checkbox" name="hobbies_interests" value="Foodie" id="h-9" class="card-input"><label for="h-9" class="card-label">Foodie</label></div>
                        </div>
                    </div>
                </div>

                <div class="form-step">
                    <div class="question">
                        <h3 class="question-title">What's your current academic year?</h3>
                        <div class="card-options">
                            <div><input type="radio" name="year" value="1st Year" id="y-1" class="card-input" required><label for="y-1" class="card-label">1st Year</label></div>
                            <div><input type="radio" name="year" value="2nd Year" id="y-2" class="card-input" required><label for="y-2" class="card-label">2nd Year</label></div>
                            <div><input type="radio" name="year" value="3rd Year" id="y-3" class="card-input" required><label for="y-3" class="card-label">3rd Year</label></div>
                            <div><input type="radio" name="year" value="Final Year" id="y-4" class="card-input" required><label for="y-4" class="card-label">Final Year</label></div>
                            <div><input type="radio" name="year" value="Postgraduate" id="y-5" class="card-input" required><label for="y-5" class="card-label">Postgraduate</label></div>
                        </div>
                    </div>
                    <div class="question">
                        <h3 class="question-title">Your relationship status is...</h3>
                        <div class="card-options">
                            <div><input type="radio" name="relationship_status" value="Single" id="rs-1" class="card-input" required><label for="rs-1" class="card-label">Single</label></div>
                            <div><input type="radio" name="relationship_status" value="Taken" id="rs-2" class="card-input" required><label for="rs-2" class="card-label">Taken</label></div>
                            <div><input type="radio" name="relationship_status" value="It's Complicated" id="rs-3" class="card-input" required><label for="rs-3" class="card-label">It's Complicated</label></div>
                            <div><input type="radio" name="relationship_status" value="Focusing on me" id="rs-4" class="card-input" required><label for="rs-4" class="card-label">Focusing on me</label></div>
                        </div>
                    </div>
                    <div class="question">
                        <h3 class="question-title">And you're looking for...</h3>
                        <div class="card-options large-grid">
                            <div><input type="radio" name="looking_for" value="Friendship" id="lf-1" class="card-input" required><label for="lf-1" class="card-label">Friendship</label></div>
                            <div><input type="radio" name="looking_for" value="Girlfriend" id="lf-2" class="card-input" required><label for="lf-2" class="card-label">Girlfriend</label></div>
                            <div><input type="radio" name="looking_for" value="Boyfriend" id="lf-3" class="card-input" required><label for="lf-3" class="card-label">Boyfriend</label></div>
                            <div><input type="radio" name="looking_for" value="Serious Relationship" id="lf-4" class="card-input" required><label for="lf-4" class="card-label">Serious Relationship</label></div>
                            <div><input type="radio" name="looking_for" value="FWB" id="lf-5" class="card-input" required><label for="lf-5" class="card-label">FWB</label></div>
                            <div><input type="radio" name="looking_for" value="Something Casual" id="lf-6" class="card-input" required><label for="lf-6" class="card-label">Something Casual</label></div>
                            <div><input type="radio" name="looking_for" value="Let's see where it goes" id="lf-7" class="card-input" required><label for="lf-7" class="card-label">Let's see where it goes</label></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="btn-group">
            <button class="btn btn-prev" id="prevBtn" disabled>Previous</button>
            <button class="btn" id="nextBtn">Next</button>
        </div>
    </main>

    <footer class="footer">Poornima college student</footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const loaderContainer = document.getElementById("loaderContainer");
            if (loaderContainer && loaderContainer.style.display !== 'none') {
                setTimeout(() => {
                    loaderContainer.style.opacity = '0';
                    loaderContainer.addEventListener('transitionend', () => loaderContainer.style.display = 'none', { once: true });
                }, 1000);
            }

            const multiStepForm = document.getElementById('multiStepForm');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progress = document.getElementById('progress');
            const steps = document.querySelectorAll('.progress-bar .step');
            
            let currentStep = 1;
            const totalSteps = 3;

            nextBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (validateStep(currentStep)) {
                    if (currentStep < totalSteps) {
                        currentStep++;
                        updateForm();
                    } else if (currentStep === totalSteps) {
                        // ✅ FIX 2: Correctly submit the form
                        const submitButton = document.getElementById('nextBtn');
                        submitButton.classList.add('btn--loading');
                        const spinner = document.createElement('div');
                        spinner.className = 'btn-spinner';
                        submitButton.innerHTML = ''; // Clear current text
                        submitButton.appendChild(spinner);
                        
                        // This line now correctly submits the form to your Django view
                        multiStepForm.submit();
                    }
                }
            });

            prevBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentStep > 1) {
                    currentStep--;
                    updateForm();
                }
            });

            function updateForm() {
                multiStepForm.style.transform = `translateX(-${(currentStep - 1) * (100 / totalSteps)}%)`;
                progress.style.width = `${((currentStep - 1) / (totalSteps - 1)) * 100}%`;
                steps.forEach((step, index) => step.classList.toggle('active', index < currentStep));
                prevBtn.disabled = currentStep === 1;
                nextBtn.textContent = (currentStep === totalSteps) ? 'Finish & Find Matches' : 'Next';
            }

            function validateStep(step) {
                const currentFormStep = multiStepForm.children[step - 1 + 1]; // Adjust index because of csrf_token
                const questions = currentFormStep.querySelectorAll('.question');
                let allValid = true;

                questions.forEach(q => {
                    const inputs = q.querySelectorAll('input[type="radio"], input[type="checkbox"]');
                    const isRadio = inputs[0] && inputs[0].type === 'radio';
                    const isChecked = Array.from(inputs).some(input => input.checked);

                    if (isRadio && !isChecked) {
                        q.style.border = '2px solid #dc3545';
                        q.style.borderRadius = 'var(--radius)';
                        q.style.padding = '10px';
                        allValid = false;
                        setTimeout(() => {
                            q.style.border = 'none';
                            q.style.padding = '0';
                        }, 3000);
                    } else {
                        q.style.border = 'none';
                        q.style.padding = '0';
                    }
                });
                return allValid;
            }

            // Hobby selection limit
            const hobbyCheckboxes = document.querySelectorAll('input[name="hobbies_interests"]');
            const maxHobbies = 5;
            hobbyCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const checkedCount = document.querySelectorAll('input[name="hobbies_interests"]:checked').length;
                    if (checkedCount > maxHobbies) {
                        checkbox.checked = false;
                        alert(`You can select maximum ${maxHobbies} hobbies.`);
                    }
                });
            });
        });
    </script>
</body>
</html>